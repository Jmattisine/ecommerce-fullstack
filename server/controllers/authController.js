import bcrypt from 'bcryptjs'; import jwt from 'jsonwebtoken'; import User from '../models/User.js';
export async function register(req,res){const {name,email,password}=req.body;const ex=await User.findOne({email});if(ex)return res.status(400).json({msg:'Email ya registrado'});const hash=await bcrypt.hash(password,10);const u=await User.create({name,email,password:hash});const token=jwt.sign({user:{id:u._id,role:u.role}},process.env.JWT_SECRET||'dev',{expiresIn:'7d'});res.json({token,user:{id:u._id,name:u.name,email:u.email,role:u.role}})}
export async function login(req,res){const {email,password}=req.body;const u=await User.findOne({email});if(!u)return res.status(400).json({msg:'Credenciales inválidas'});const ok=await bcrypt.compare(password,u.password);if(!ok)return res.status(400).json({msg:'Credenciales inválidas'});const token=jwt.sign({user:{id:u._id,role:u.role}},process.env.JWT_SECRET||'dev',{expiresIn:'7d'});res.json({token,user:{id:u._id,name:u.name,email:u.email,role:u.role}})}
export async function me(req,res){const u=await User.findById(req.user.id).select('-password');res.json(u)}
